# üì∏ Image Service

## üìå –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Image Service

**Image Service** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤—è–∑–∫–µ —Å **Product Service** –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

- üîπ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
- üîπ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
- üîπ –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –æ–±–ª–∞–∫–µ (**MinIO —Å–µ—Ä–≤–∏—Å**) –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –Ω–∏–º.
- üîπ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞.

---

## üî• –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Image Service

### 1Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ: **5 MB**.
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: **JPG, PNG**.

### 2Ô∏è‚É£ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- üîπ –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ –æ–±–ª–∞–∫–∞ **–≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)**.
- üîπ –ü—Ä–∏ –æ—à–∏–±–∫–µ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ **Redis** (`failed_deletes`) –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏.
- üîπ **–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞** –∫–∞–∂–¥—ã–µ **24 —á–∞—Å–∞** –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ `failed_deletes`.

### 3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞
- üîπ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏** –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- üîπ **Image Service** –¥–æ–ª–∂–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—å **UUID** –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

### 4Ô∏è‚É£ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Kafka (Product Service ‚Üí Kafka ‚Üí Image Service)
- üîπ **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞** ‚Üí Image Service —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç **UUID** –ø—Ä–æ–¥—É–∫—Ç–∞.
- üîπ **–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞** ‚Üí Image Service —É–¥–∞–ª—è–µ—Ç **–≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**. 

## üîÑ –§–æ–Ω–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ `failed_deletes`
1. –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ **—É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –ë–î**, –Ω–æ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑ **MinIO** –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –µ–≥–æ `UUID` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫—ç—à `failed_deletes`.
2. –†–∞–∑ –≤ **24 —á–∞—Å–∞** —Ñ–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ —É–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ –∏–∑ –æ–±–ª–∞–∫–∞

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Spring**
- **Kafka**
- **MinIO Cloud**
- **Docker**
- **Redis**
- **Flyway**
- **PostgreSQL**

---

## ‚úÖ Use Case'—ã

### 1Ô∏è‚É£ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è)
1. **–í—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** `productId`, `file` (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ).
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:**
   - ‚ùå –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç **–Ω–µ –Ω–∞–π–¥–µ–Ω** ‚Üí `404 Not Found`.
   - ‚ùå –ï—Å–ª–∏ —Ñ–∞–π–ª **–Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º** ‚Üí –æ—à–∏–±–∫–∞.
3. **MinIO –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç UUID** –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
4. **–°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ë–î** (–∏ –æ—á–∏—â–∞–µ–º Redis).
5. **–ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –≤ MinIO**.
   - ‚ùå –û—à–∏–±–∫–∞ –≤ MinIO ‚Üí –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º `MinioException`, –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

---

### üóë –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å** –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ (`imageId`).
2. **–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ** –≤ –ë–î.
   - ‚ùå –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí `404 Not Found`.
3. **–£–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ –ë–î –∏ Redis**.
4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** –∏–∑ MinIO.
   - ‚ö° –ö–ª–∏–µ–Ω—Ç—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `202 Accepted` (–æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∞, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è).
5. **–£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ MinIO**.
   - ‚ùå –û—à–∏–±–∫–∞ –≤ MinIO ‚Üí **—Å–æ—Ö—Ä–∞–Ω—è–µ–º UUID** –≤ Redis (`failed_deletes`).

---

### üîó –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å** (`productId`).
2. **–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞** –≤ Image Service (Redis).
   - ‚ùå –ï—Å–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ **–Ω–µ—Ç** ‚Üí –æ—à–∏–±–∫–∞.
3. **–ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à** (Redis).
   - ‚úÖ –ï—Å–ª–∏ —Å—Å—ã–ª–∫–∏ **–µ—Å—Ç—å** ‚Üí —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ–º.
4. **–ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ —É MinIO**.
   - ‚ùå –û—à–∏–±–∫–∞ ‚Üí `500 Internal Server Error`.
5. **–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –≤ Redis** (–Ω–∞ **50 –º–∏–Ω—É—Ç**).
6. **–í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Å—ã–ª–∫–∏** –∫–ª–∏–µ–Ω—Ç—É.

---

### üîÑ –§–æ–Ω–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞ `failed_deletes`
1. **–†–∞–∑ –≤ 24 —á–∞—Å–∞** —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `failed_deletes`.
2. **–ü—ã—Ç–∞–µ—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ —É–¥–∞–ª–∏—Ç—å** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ **MinIO**.
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –£–¥–∞–ª–µ–Ω–æ? ‚Üí `UUID` —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –∫—ç—à–∞.
   - ‚ùå –û—à–∏–±–∫–∞? ‚Üí `UUID` –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫—ç—à–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–∏.

---

## üì° Kafka Events (Image Service ‚Üî Product Service)

### üìå –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (`product.created`)
1. **Product Service** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `product.created` –≤ **Kafka** (—Å `UUID` –ø—Ä–æ–¥—É–∫—Ç–∞).
2. **Image Service** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `UUID` –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º–µ (–¥–æ –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è).

### üóë –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ (`product.deleted`)
1. **Product Service** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `product.deleted` –≤ **Kafka** (—Å `UUID` –ø—Ä–æ–¥—É–∫—Ç–∞).
2. **Image Service** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–±—ã—Ç–∏–µ –∏:
   - –£–¥–∞–ª—è–µ—Ç **–≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–∑ **MinIO**.
   - –£–¥–∞–ª—è–µ—Ç –ø—Ä–æ–¥—É–∫—Ç –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.

–†–µ–∑—É–ª—å—Ç–∞—Ç:  
‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω—ã –∏–∑ **–æ–±–ª–∞–∫–∞** –∏ **–ë–î**.  
‚úÖ `UUID` –ø—Ä–æ–¥—É–∫—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ.

---